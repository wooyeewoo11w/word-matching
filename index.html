<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>单词消消乐</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f0f9ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .settings {
            margin: 20px 0;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .game-board {
            display: grid;
            gap: 8px;
            padding: 15px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card {
            background: #e3f2fd; /* 淡蓝色背景 */
            border: 2px solid #90caf9;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            min-width: 80px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            position: relative;
            transform-style: preserve-3d;
        }

        .card.flip {
            background: #c8e6c9; /* 点击后变为绿色 */
            transform: rotateY(180deg);
        }

        .card.matched {
            opacity: 0;
            pointer-events: none;
        }

        .info {
            margin: 15px 0;
            font-size: 18px;
            color: #2c3e50;
        }

        input[type="number"] {
            padding: 8px 12px;
            border: 2px solid #90caf9;
            border-radius: 6px;
            width: 100px;
        }

        button {
            padding: 8px 20px;
            background: #42a5f5;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: #2196f3;
        }
    </style>
</head>
<body>
    <h1 style="color: #2c3e50;">单词消消乐</h1>
    <div class="settings">
        <input type="number" id="gridSize" min="2" max="8" step="2" value="4" placeholder="偶数尺寸">
        <button onclick="startNewGame()">开始游戏</button>
    </div>
    <div class="info">
        得分: <span id="score">0</span>
    </div>
    <div id="gameBoard" class="game-board"></div>
    <script src="chinese-map.js"></script>
    <script>
        // 自动生成小学英语词汇库（800+基础词汇）
        const generateVocabulary = () => {
            let words = [];
            for (const [category, enWords] of Object.entries(categories)) {
                enWords.forEach(en => {
                    words.push({
                        en: en,
                        cn: chineseMap[en] || `${en}（待翻译）`,
                        category: category
                    });
                });
            }
            return words.slice(0, 800); // 控制词汇数量
        };

        const words = generateVocabulary();
        let selectedCards = [];
        let score = 0;
        let matchedPairs = 0;

        function startNewGame() {
            const gridSize = Math.max(2, Math.min(8,
                parseInt(document.getElementById('gridSize').value) || 4));
            initGame(gridSize);
        }

        function initGame(gridSize) {
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';
            gameBoard.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            
            // 生成卡片对
            const pairsNeeded = (gridSize ** 2) / 2;
            const selectedWords = shuffleArray([...words]).slice(0, pairsNeeded);
            const cardPairs = selectedWords.flatMap(word => [
                { ...word, type: 'en' },
                { ...word, type: 'cn' }
            ]);

            shuffleArray(cardPairs).forEach(word => {
                const card = createCardElement(word);
                gameBoard.appendChild(card);
            });

            // 重置游戏状态
            selectedCards = [];
            score = 0;
            matchedPairs = 0;
            document.getElementById('score').textContent = '0';
        }

        function createCardElement(word) {
            const card = document.createElement('div');
            card.className = 'card';
            card.textContent = word.type === 'en' ? word.en : word.cn;
            card.dataset.key = word.en;
            card.addEventListener('click', () => handleCardClick(card));
            return card;
        }

        function handleCardClick(card) {
            if (card.classList.contains('matched') || selectedCards.includes(card)) return;

            card.classList.add('flip');
            selectedCards.push(card);
            
            if (selectedCards.length === 2) {
                setTimeout(checkMatch, 600);
            }
        }

        function checkMatch() {
            const [card1, card2] = selectedCards;
            const isMatch = card1.dataset.key === card2.dataset.key;
            
            if (isMatch) {
                score += 100;
                matchedPairs++;
                document.getElementById('score').textContent = score;
                card1.classList.add('matched');
                card2.classList.add('matched');
                playSound('match'); // 匹配成功音效

                // 检查是否全部匹配完成
                if (matchedPairs === (parseInt(document.getElementById('gridSize').value) ** 2) / 2) {
                    setTimeout(() => {
                        alert(`游戏胜利！得分：${score}`);
                    }, 500);
                }
            } else {
                card1.classList.remove('flip');
                card2.classList.remove('flip');
                playSound('error'); // 匹配失败音效
            }
            
            selectedCards = [];
        }

        // 播放音效
        function playSound(type) {
    if (type === 'match') {
        playSuccessSound();
    } else if (type === 'error') {
        playErrorSound();
    }
}

        // 辅助函数：数组随机排序
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // 匹配成功音效（高音）
function playSuccessSound() {
    const context = new AudioContext();
    const oscillator = context.createOscillator();
    oscillator.frequency.value = 580; // 频率（Hz）
    oscillator.connect(context.destination);
    oscillator.start();
    oscillator.stop(context.currentTime + 0.5); // 持续时间
}

// 匹配失败音效（低音）
function playErrorSound() {
    const context = new AudioContext();
    const oscillator = context.createOscillator();
    oscillator.frequency.value = 220; // 频率（Hz）
    oscillator.connect(context.destination);
    oscillator.start();
    oscillator.stop(context.currentTime + 0.5); // 持续时间
}
        

        // 初始化游戏
        startNewGame();
    </script>
</body>
</html>